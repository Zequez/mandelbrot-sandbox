{"version":3,"sources":["webpack:///./src/index.tsx","webpack:///../pkg/mandelbrot_sandbox_bg.js","webpack:///./src/MandelbrotRenderer.tsx","webpack:///../pkg/mandelbrot_sandbox.js","webpack:///./src/utils.ts"],"names":["__createBinding","this","Object","create","o","m","k","k2","undefined","defineProperty","enumerable","get","__setModuleDefault","v","value","__importStar","mod","__esModule","result","prototype","hasOwnProperty","call","__importDefault","exports","DragMode","react_1","require","react_dom_1","MandelbrotRenderer_1","defaults","window","location","hash","queryString","slice","split","reduce","all","val","n","parseFloat","isNaN","initialCenterX","x","initialCenterY","y","initialFocusDX","f","default","render","createElement","containerRef","useRef","useState","dragging","setDragging","mandelbrot","setMandelbrot","zoomStack","setZoomStack","dragD","endX","startX","endY","startY","zoomD","mode","Zoom","Math","min","max","zoomBackOut","length","lastZoom","setHistory","history","replaceState","useEffect","initializeMandelbrot","current","resDX","clientWidth","resDY","clientHeight","focusDX","setTimeout","centerX","centerY","focusDY","iterations","dragDX","dragDY","zoomStartX","zoomStartY","zoomEndX","zoomEndY","isOnStart","className","ref","style","cursor","Move","onMouseDown","ev","button","clientX","clientY","onMouseMove","onMouseUp","newCenterX","newCenterY","ratioX","ratioY","aspectRatioXY","dPxX","dPxY","dx","dy","concat","onContextMenu","preventDefault","transform","border","position","top","left","width","height","assign","onClick","type","onChange","target","valueAsNumber","goToStart","document","getElementById","cachedTextDecoder","TextDecoder","module","ignoreBOM","fatal","decode","cachegetUint8Memory0","getStringFromWasm0","ptr","len","buffer","Uint8Array","subarray","radius","Mandelbrot","obj","res_x","res_y","palette","instance","klass","Error","name","_assertClass","Palette","ptr0","ret","__wrap","focus_x","focus_y","__wbindgen_throw","arg0","arg1","mandelbrot_sandbox_1","mandelbrot_sandbox_bg_wasm_1","utils_1","new","rest","canvasRef","ctx","orPanic","getContext","cb","universe","pixels","Uint8ClampedArray","memory","ImageData","free","mandelbrotImageData","imageData","putImageData"],"mappings":"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","file":"2.bootstrap.js","sourcesContent":["\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst react_1 = __importStar(require(\"react\"));\nconst react_dom_1 = __importDefault(require(\"react-dom\"));\nconst MandelbrotRenderer_1 = __importDefault(require(\"./MandelbrotRenderer\"));\nvar DragMode;\n(function (DragMode) {\n    DragMode[DragMode[\"Move\"] = 1] = \"Move\";\n    DragMode[DragMode[\"Zoom\"] = 2] = \"Zoom\";\n})(DragMode || (DragMode = {}));\nconst INITIAL_CENTER_X = 0;\nconst INITIAL_CENTER_Y = -0.7;\nconst INITIAL_FOCUS_DX = 2.5;\nconst INITIAL_ITERATIONS = 200;\nconst MandelbrotExplorer = ({ initialCenterX, initialCenterY, initialFocusDX, }) => {\n    const containerRef = react_1.useRef(null);\n    const [dragging, setDragging] = react_1.useState(null);\n    const [mandelbrot, setMandelbrot] = react_1.useState(null);\n    const [zoomStack, setZoomStack] = react_1.useState([]);\n    react_1.useEffect(initializeMandelbrot, []);\n    function initializeMandelbrot() {\n        if (containerRef.current != null) {\n            const resDX = containerRef.current.clientWidth;\n            const resDY = containerRef.current.clientHeight;\n            const focusDX = initialFocusDX ?? INITIAL_FOCUS_DX;\n            if (resDY === 0 || resDX === 0) {\n                setTimeout(initializeMandelbrot, 100);\n                return;\n            }\n            setMandelbrot({\n                resDX,\n                resDY,\n                centerX: initialCenterX ?? INITIAL_CENTER_X,\n                centerY: initialCenterY ?? INITIAL_CENTER_Y,\n                focusDX,\n                focusDY: (resDY / resDX) * focusDX,\n                iterations: INITIAL_ITERATIONS,\n            });\n        }\n    }\n    function goToStart() {\n        if (mandelbrot != null) {\n            const { resDX, resDY } = mandelbrot;\n            const focusDX = INITIAL_FOCUS_DX;\n            setMandelbrot({\n                resDX,\n                resDY,\n                centerX: INITIAL_CENTER_X,\n                centerY: INITIAL_CENTER_Y,\n                focusDX,\n                focusDY: (resDY / resDX) * focusDX,\n                iterations: INITIAL_ITERATIONS,\n            });\n        }\n    }\n    function onDragStart(ev) {\n        if (ev.button === 0 || ev.button === 1) {\n            setDragging({\n                mode: ev.button === 0 ? DragMode.Zoom : DragMode.Move,\n                startX: ev.clientX,\n                startY: ev.clientY,\n                endX: ev.clientX,\n                endY: ev.clientY,\n            });\n        }\n    }\n    function onDragProgress(ev) {\n        if (dragging != null) {\n            setDragging({ ...dragging, endX: ev.clientX, endY: ev.clientY });\n        }\n    }\n    function onDragEnd(ev) {\n        if (mandelbrot != null) {\n            if (dragging?.mode === DragMode.Move) {\n                const [dragDX, dragDY] = dragD();\n                const { resDX, resDY, focusDX, focusDY, centerX, centerY } = mandelbrot;\n                const newCenterX = centerX - (focusDX / resDX) * dragDX;\n                const newCenterY = centerY - (focusDY / resDY) * dragDY;\n                setMandelbrot({\n                    ...mandelbrot,\n                    centerX: newCenterX,\n                    centerY: newCenterY,\n                });\n                setHistory(newCenterX, newCenterY, focusDX);\n            }\n            if (dragging?.mode === DragMode.Zoom) {\n                let [startX, startY, endX, endY] = zoomD();\n                const { resDX, resDY, focusDX, focusDY, centerX, centerY } = mandelbrot;\n                const ratioX = focusDX / resDX;\n                const ratioY = focusDY / resDY;\n                const aspectRatioXY = resDX / resDY;\n                // This is awful, but it works\n                // Zoom by maintaining the aspect ratio, and also the center\n                let dPxX = endX - startX;\n                let dPxY = endY - startY;\n                const zoomAspectRatioXY = dPxX / dPxY;\n                if (zoomAspectRatioXY > aspectRatioXY) {\n                    let diff = dPxY - dPxX / aspectRatioXY;\n                    startY += diff / 2;\n                    dPxY = dPxX / aspectRatioXY;\n                }\n                else {\n                    let diff = dPxX - dPxY * aspectRatioXY;\n                    startX += diff / 2;\n                    dPxX = dPxY * aspectRatioXY;\n                }\n                const dx = ratioX * dPxX;\n                const dy = ratioY * dPxY;\n                if (dPxX >= 2 && dPxY >= 2) {\n                    setZoomStack(zoomStack.concat([{ centerX, centerY, focusDX, focusDY }]));\n                    const newCenterX = centerX - focusDX / 2 + startX * ratioX + dx / 2;\n                    const newCenterY = centerY - focusDY / 2 + startY * ratioY + dy / 2;\n                    setMandelbrot({\n                        ...mandelbrot,\n                        focusDX: dx,\n                        focusDY: dy,\n                        centerX: newCenterX,\n                        centerY: newCenterY,\n                    });\n                    setHistory(newCenterX, newCenterY, dx);\n                }\n            }\n            setDragging(null);\n        }\n    }\n    function dragD() {\n        return [\n            dragging ? dragging.endX - dragging.startX : 0,\n            dragging ? dragging.endY - dragging.startY : 0,\n        ];\n    }\n    function zoomD() {\n        if (dragging?.mode === DragMode.Zoom && mandelbrot !== null) {\n            return [\n                Math.min(dragging.startX, dragging.endX),\n                Math.min(dragging.startY, dragging.endY),\n                Math.max(dragging.startX, dragging.endX),\n                Math.max(dragging.startY, dragging.endY),\n            ];\n        }\n        else {\n            return [0, 0, 0, 0];\n        }\n    }\n    function zoomBackOut() {\n        if (zoomStack.length > 0 && mandelbrot !== null) {\n            const lastZoom = zoomStack.slice(-1)[0];\n            setZoomStack(zoomStack.slice(0, -1));\n            setMandelbrot({ ...mandelbrot, ...lastZoom });\n        }\n    }\n    function resetZoom() {\n        if (mandelbrot !== null) {\n            setZoomStack([]);\n            goToStart();\n        }\n    }\n    function setHistory(x, y, f) {\n        window.history.replaceState(null, \"\", `#!x=${x}&y=${y}&f=${f}`);\n    }\n    const [dragDX, dragDY] = dragD();\n    const [zoomStartX, zoomStartY, zoomEndX, zoomEndY] = zoomD();\n    const isOnStart = INITIAL_FOCUS_DX == mandelbrot?.focusDX;\n    return (react_1.default.createElement(\"div\", { className: \"absolute inset-0\" },\n        react_1.default.createElement(\"div\", { ref: containerRef, className: \"absolute inset-0 overflow-hidden\", style: {\n                cursor: dragging?.mode === DragMode.Move ? \"grabbing\" : \"default\",\n            }, onMouseDown: onDragStart, onMouseMove: onDragProgress, onMouseUp: onDragEnd, onContextMenu: (ev) => {\n                if (zoomStack.length > 0) {\n                    ev.preventDefault();\n                    zoomBackOut();\n                }\n            } },\n            react_1.default.createElement(\"div\", { className: \"h-full w-full\", style: {\n                    transform: dragging?.mode === DragMode.Move\n                        ? `translate(${dragDX}px, ${dragDY}px)`\n                        : \"\",\n                } },\n                dragging?.mode === DragMode.Zoom ? (react_1.default.createElement(\"div\", { style: {\n                        border: \"solid 1px red\",\n                        position: \"absolute\",\n                        top: `${zoomStartY}px`,\n                        left: `${zoomStartX}px`,\n                        width: `${zoomEndX - zoomStartX}px`,\n                        height: `${zoomEndY - zoomStartY}px`,\n                    } })) : null,\n                mandelbrot !== null ? react_1.default.createElement(MandelbrotRenderer_1.default, Object.assign({}, mandelbrot)) : null)),\n        mandelbrot !== null ? (react_1.default.createElement(\"div\", { className: \"\\n            absolute inset-x-0 bottom-0 p-2\\n            flex items-center\\n            bg-black bg-opacity-50 text-white\" },\n            \"Iterations:\",\n            react_1.default.createElement(\"button\", { className: \"ml-2 px-2 rounded-sm bg-blue-500\", onClick: () => setMandelbrot({\n                    ...mandelbrot,\n                    iterations: mandelbrot.iterations > 100\n                        ? mandelbrot.iterations - 100\n                        : 10,\n                }) }, \"-100\"),\n            react_1.default.createElement(\"input\", { className: \"ml-2 rounded-sm w-16 text-black p-0 text-center\", type: \"number\", value: mandelbrot.iterations, onChange: (ev) => setMandelbrot({\n                    ...mandelbrot,\n                    iterations: ev.target.valueAsNumber,\n                }) }),\n            react_1.default.createElement(\"button\", { className: \"ml-2 px-2 rounded-sm bg-blue-500\", onClick: () => setMandelbrot({\n                    ...mandelbrot,\n                    iterations: mandelbrot.iterations + 100,\n                }) }, \"+100\"),\n            react_1.default.createElement(\"div\", { className: \"text-xs ml-4\" }, \"MClick = Drag; LDrag = Zoom; RClick = ZoomOut\"),\n            react_1.default.createElement(\"div\", { className: \"flex-grow\" }),\n            react_1.default.createElement(\"div\", { className: \"\" },\n                !isOnStart ? (react_1.default.createElement(\"button\", { className: \"px-2 rounded-sm bg-blue-500\", onClick: resetZoom }, \"Reset zoom\")) : null,\n                zoomStack.length > 0 ? (react_1.default.createElement(\"button\", { className: \"ml-2 px-2 rounded-sm bg-blue-500\", onClick: zoomBackOut }, \"Zoom back\")) : null))) : null));\n};\nlet defaults = {};\nif (window?.location?.hash) {\n    const queryString = window.location.hash\n        .slice(2)\n        .split(\"&\")\n        .reduce((all, val) => {\n        let [k, v] = val.split(\"=\");\n        let n = parseFloat(v);\n        if (!isNaN(n))\n            all[k] = n;\n        return all;\n    }, {});\n    defaults = {\n        initialCenterX: queryString?.x,\n        initialCenterY: queryString?.y,\n        initialFocusDX: queryString?.f,\n    };\n}\nreact_dom_1.default.render(react_1.default.createElement(MandelbrotExplorer, Object.assign({}, defaults)), document.getElementById(\"root\"));\n","import * as wasm from './mandelbrot_sandbox_bg.wasm';\n\nconst lTextDecoder = typeof TextDecoder === 'undefined' ? (0, module.require)('util').TextDecoder : TextDecoder;\n\nlet cachedTextDecoder = new lTextDecoder('utf-8', { ignoreBOM: true, fatal: true });\n\ncachedTextDecoder.decode();\n\nlet cachegetUint8Memory0 = null;\nfunction getUint8Memory0() {\n    if (cachegetUint8Memory0 === null || cachegetUint8Memory0.buffer !== wasm.memory.buffer) {\n        cachegetUint8Memory0 = new Uint8Array(wasm.memory.buffer);\n    }\n    return cachegetUint8Memory0;\n}\n\nfunction getStringFromWasm0(ptr, len) {\n    return cachedTextDecoder.decode(getUint8Memory0().subarray(ptr, ptr + len));\n}\n\nfunction _assertClass(instance, klass) {\n    if (!(instance instanceof klass)) {\n        throw new Error(`expected instance of ${klass.name}`);\n    }\n    return instance.ptr;\n}\n/**\n* @param {number} x\n* @param {number} y\n* @param {number} iterations\n* @param {number} radius\n* @returns {number}\n*/\nexport function mandelbrot(x, y, iterations, radius) {\n    var ret = wasm.mandelbrot(x, y, iterations, radius);\n    return ret;\n}\n\n/**\n*/\nexport class Mandelbrot {\n\n    static __wrap(ptr) {\n        const obj = Object.create(Mandelbrot.prototype);\n        obj.ptr = ptr;\n\n        return obj;\n    }\n\n    free() {\n        const ptr = this.ptr;\n        this.ptr = 0;\n\n        wasm.__wbg_mandelbrot_free(ptr);\n    }\n    /**\n    * @param {number} res_x\n    * @param {number} res_y\n    * @param {Palette} palette\n    * @returns {Mandelbrot}\n    */\n    static new(res_x, res_y, palette) {\n        _assertClass(palette, Palette);\n        var ptr0 = palette.ptr;\n        palette.ptr = 0;\n        var ret = wasm.mandelbrot_new(res_x, res_y, ptr0);\n        return Mandelbrot.__wrap(ret);\n    }\n    /**\n    * @param {number} x\n    * @param {number} y\n    * @param {number} focus_x\n    * @param {number} focus_y\n    * @param {number} iterations\n    */\n    render(x, y, focus_x, focus_y, iterations) {\n        wasm.mandelbrot_render(this.ptr, x, y, focus_x, focus_y, iterations);\n    }\n    /**\n    * @returns {number}\n    */\n    pixels() {\n        var ret = wasm.mandelbrot_pixels(this.ptr);\n        return ret;\n    }\n}\n/**\n*/\nexport class Palette {\n\n    static __wrap(ptr) {\n        const obj = Object.create(Palette.prototype);\n        obj.ptr = ptr;\n\n        return obj;\n    }\n\n    free() {\n        const ptr = this.ptr;\n        this.ptr = 0;\n\n        wasm.__wbg_palette_free(ptr);\n    }\n    /**\n    * @returns {Palette}\n    */\n    static new() {\n        var ret = wasm.palette_new();\n        return Palette.__wrap(ret);\n    }\n}\n\nexport const __wbindgen_throw = function(arg0, arg1) {\n    throw new Error(getStringFromWasm0(arg0, arg1));\n};\n\n","\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst react_1 = __importStar(require(\"react\"));\nconst mandelbrot_sandbox_1 = require(\"mandelbrot-sandbox\");\nconst mandelbrot_sandbox_bg_wasm_1 = require(\"mandelbrot-sandbox/mandelbrot_sandbox_bg.wasm\");\nconst utils_1 = require(\"./utils\");\nconst palette = mandelbrot_sandbox_1.Palette.new();\nconst MandelbrotRenderer = ({ resDX, resDY, centerX, centerY, focusDX, focusDY, iterations, ...rest }) => {\n    const canvasRef = react_1.useRef(null);\n    react_1.useEffect(() => {\n        if (canvasRef.current) {\n            const ctx = utils_1.orPanic(canvasRef.current.getContext(\"2d\"));\n            // // Adjust resolutions\n            // if (resDX == null) {\n            //   resDX = Math.floor(canvasRef.current.clientWidth * (autoRes ?? 1));\n            // }\n            // if (resDY == null) {\n            //   resDY = Math.floor(canvasRef.current.clientHeight * (autoRes ?? 1));\n            // }\n            // if (focusDY == null) {\n            //   focusDY = (resDY / resDX) * focusDX;\n            // }\n            canvasRef.current.width = resDX;\n            canvasRef.current.height = resDY;\n            mandelbrotImageData(resDX, resDY, focusDX, focusDY, centerX, centerY, iterations, (imageData) => {\n                ctx.putImageData(imageData, 0, 0);\n            });\n        }\n    }, [resDX, resDY, focusDX, focusDY, centerX, centerY, iterations]);\n    return (react_1.default.createElement(\"canvas\", Object.assign({}, rest, { style: { height: \"100%\", width: \"100%\" }, ref: canvasRef })));\n};\nfunction mandelbrotImageData(resDX, resDY, focusDX, focusDY, centerX, centerY, iterations, cb) {\n    const universe = mandelbrot_sandbox_1.Mandelbrot.new(resDX, resDY, mandelbrot_sandbox_1.Palette.new());\n    universe.render(centerX, centerY, focusDX, focusDY, iterations);\n    const pixels = new Uint8ClampedArray(mandelbrot_sandbox_bg_wasm_1.memory.buffer, universe.pixels(), resDX * resDY * 4);\n    cb(new ImageData(pixels, resDX, resDY));\n    universe.free();\n}\nexports.default = MandelbrotRenderer;\n","import * as wasm from \"./mandelbrot_sandbox_bg.wasm\";\nexport * from \"./mandelbrot_sandbox_bg.js\";","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.orPanic = void 0;\nfunction orPanic(val) {\n    if (val == null) {\n        throw new Error(\"Can't be null\");\n    }\n    return val;\n}\nexports.orPanic = orPanic;\n"],"sourceRoot":""}